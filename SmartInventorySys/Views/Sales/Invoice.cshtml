@model SmartInventorySys.Models.Order

@{
    Layout = null; // No navbar, clean invoice
}

<!DOCTYPE html>
<html>
<head>
    <title>Invoice #@Model.OrderNumber</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            background: #525659;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* The Invoice Paper */
        #invoice-container {
            max-width: 800px;
            margin: 30px auto;
            padding: 40px;
            background: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        /* Hide buttons when printing/generating PDF */
        @@media print {
            .no-print {
                display: none !important;
            }

            body {
                background: white;
            }

            #invoice-container {
                box-shadow: none;
                border: none;
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body>

    <div class="text-center mt-3 mb-3 no-print">
        <button onclick="generatePDF()" class="btn btn-danger btn-lg shadow-sm">
            <i class="fas fa-file-pdf"></i> Download PDF
        </button>
        <button onclick="window.print()" class="btn btn-secondary btn-lg shadow-sm ms-2">
            <i class="fas fa-print"></i> Print
        </button>
        <a href="/Sales" class="btn btn-light btn-lg shadow-sm ms-2">
            <i class="fas fa-arrow-left"></i> Back to POS
        </a>
    </div>

    <div id="invoice-container">

        <div class="d-flex justify-content-between align-items-start mb-5">
            <div>
                <h2 class="text-primary fw-bold"><i class="fas fa-cubes"></i> SmartStore</h2>
                <p class="text-muted mb-0">Kathmandu, Nepal</p>
                <p class="text-muted mb-0">Phone: +977-9800000000</p>
                <p class="text-muted">Email: info@smartstore.com</p>
            </div>
            <div class="text-end">
                <h4 class="fw-bold text-uppercase text-secondary">Invoice</h4>
                <p class="mb-1"><strong>Invoice No:</strong> @Model.OrderNumber</p>
                <p class="mb-1"><strong>Date:</strong> @Model.OrderDate.ToString("yyyy-MM-dd HH:mm")</p>
                <p class="mb-0"><strong>Cashier:</strong> @(Model.UserId ?? "System")</p>
            </div>
        </div>

        <hr class="my-4" style="opacity: 0.1" />

        <table class="table table-striped table-bordered mt-4">
            <thead class="table-dark">
                <tr>
                    <th>Item</th>
                    <th class="text-center">Qty</th>
                    <th class="text-end">Price</th>
                    <th class="text-end">Total</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.OrderDetails)
                {
                    <tr>
                        <td>@(item.Product?.Name ?? "Unknown Item")</td>
                        <td class="text-center">@item.Quantity</td>
                        <td class="text-end">Rs. @item.UnitPrice.ToString("N2")</td>
                        <td class="text-end">Rs. @((item.Quantity * item.UnitPrice).ToString("N2"))</td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="row mt-4">
            <div class="col-6">
                <div class="p-3 bg-light rounded border">
                    <p class="mb-1"><strong>Payment Method:</strong> @Model.PaymentMethod</p>
                    <p class="mb-1"><strong>Notes:</strong></p>
                    <p class="small text-muted">@Model.Comments</p>
                </div>
            </div>
            <div class="col-6">
                <table class="table table-sm table-borderless text-end">
                    <tr>
                        <td>Sub Total:</td>
                        <td class="fw-bold">Rs. @Model.SubTotal.ToString("N2")</td>
                    </tr>
                    <tr>
                        <td>Discount:</td>
                        <td class="text-danger">- Rs. @Model.DiscountAmount.ToString("N2")</td>
                    </tr>
                    <tr>
                        <td>VAT (13%):</td>
                        <td class="text-info">+ Rs. @Model.TaxAmount.ToString("N2")</td>
                    </tr>
                    <tr class="border-top border-dark">
                        <th class="pt-3">Grand Total:</th>
                        <th class="pt-3 text-success h4">Rs. @Model.TotalAmount.ToString("N2")</th>
                    </tr>
                </table>
            </div>
        </div>

        <div class="text-center mt-5 pt-4 text-muted small border-top">
            <p>Thank you for your business!</p>
            <p>Goods once sold will not be returned. Terms & Conditions apply.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        function generatePDF() {
            // Select the element we want to export
            var element = document.getElementById('invoice-container');

            // Configuration options
            var opt = {
                margin:       0.5, // inch
                // FIX: Added quotes '' and parentheses () to prevent the .jpg error
                filename:     'Invoice_@(Model.OrderNumber).pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
            };

            // Execute
            html2pdf().set(opt).from(element).save();
        }
    </script>

</body>
</html>